{"version":3,"file":"fnFetch.js","names":["_fetchJson","_interopRequireDefault","require","_fetchCsvStream","CLICK_TIME_INTERVAL","MIN_FREQUENCY","DONE","_crErrMsg","errCaption","message","ERR_MSG_EMPTY_ROUTE","ERR_MSG_FREQUENCY","ERR_MSG_IN_PROGRESS","_crErr","_temp","status","statusText","_crErrResp","_recentUri","_recentTime","Date","now","_recentCall","_setRecentUriTime","uri","time","_starLoading","nowTime","_doneOk","_doneFailure","_default","config","option","onFailed","onCatch","_nowTime","error","_configFetch","fetchType","fetchCsvStream","fetchJson","exports","default"],"sources":["../../src/network/fnFetch.js"],"sourcesContent":["import fetchJson from './fetchJson';\r\nimport fetchCsvStream from './fetchCsvStream';\r\n\r\nconst CLICK_TIME_INTERVAL = 300\r\n, MIN_FREQUENCY = 3000\r\n, DONE = 'DONE'\r\n, _crErrMsg = (\r\n  errCaption,\r\n  message\r\n) => ({\r\n  errCaption,\r\n  message\r\n})\r\n, ERR_MSG_EMPTY_ROUTE = _crErrMsg('Route is not exist')\r\n, ERR_MSG_FREQUENCY = _crErrMsg(\r\n  'Load Frequency',\r\n  `Exceed item load frequency restriction of ${MIN_FREQUENCY/1000}s`\r\n)\r\n, ERR_MSG_IN_PROGRESS = _crErrMsg(\r\n  'Loading In Progress',\r\n  'Loading data for this item in progress.\\nIt seems several clicks on button Load repeatedly happend.'\r\n);\r\n\r\nconst _crErr = ({\r\n  status,\r\n  statusText\r\n}={}) => _crErrMsg(\r\n  'Request Error',\r\n  `${status}: ${statusText}`\r\n);\r\n\r\nconst _crErrResp = () => _crErrMsg(\r\n  'Response Error',\r\n  'Response format is incorrect.'\r\n);\r\n\r\nlet _recentUri = DONE\r\n, _recentTime = Date.now() - MIN_FREQUENCY\r\n, _recentCall = _recentTime;\r\n\r\nconst _setRecentUriTime = (uri, time) => {\r\n  _recentUri = uri\r\n  _recentCall = time\r\n}\r\n\r\n, _starLoading = (uri, nowTime) => {\r\n   _setRecentUriTime(uri, nowTime)\r\n}\r\n, _doneOk = (nowTime) => {\r\n   _setRecentUriTime(DONE, nowTime)\r\n}\r\n, _doneFailure = (nowTime) => {\r\n   _setRecentUriTime(DONE, nowTime)\r\n};\r\n\r\nexport default (config) => {\r\n   const {\r\n    uri,\r\n    option,\r\n    onFailed,\r\n    onCatch\r\n  } = config\r\n  , _nowTime = Date.now();\r\n\r\n  if (_nowTime - _recentCall < CLICK_TIME_INTERVAL){\r\n    return;\r\n  } else if (!uri) {\r\n    onCatch({ error: ERR_MSG_EMPTY_ROUTE, option, onFailed });\r\n  } else if (uri === _recentUri){\r\n    onCatch({ error: ERR_MSG_IN_PROGRESS, option, onFailed });\r\n  } else if (_nowTime - _recentTime < MIN_FREQUENCY){\r\n    onCatch({ error: ERR_MSG_FREQUENCY, option, onFailed });\r\n  } else {\r\n     const _configFetch = {\r\n       ...config,\r\n       _crErr,\r\n       _crErrResp,\r\n       _nowTime,\r\n       _doneOk,\r\n       _doneFailure\r\n     };\r\n\r\n    _starLoading(uri, _nowTime);\r\n\r\n    const { fetchType } = option;\r\n    if (fetchType === 'csv-stream') {\r\n      fetchCsvStream(_configFetch)\r\n    } else {\r\n      fetchJson(_configFetch)\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}