{"version":3,"file":"useXYMovable.js","names":["_uiApi","require","_has","_assign","Object","assign","_isArr","Array","isArray","_isFn","fn","INIT_EVENT","MOVE_EVENT","CANCEL_EVENT","RESET_EVENT","HAS_TOUCH_EVENTS","EVENT_OPTIONS","passive","MOVE_EVENT_OPTIONS","_fGetIntStyleProperty","propName","style","parseInt","_getIntStyleTop","_getIntStyleLeft","VALUE_GAP","_crNextValue","value","maxValue","START_EVENT_GAP","_isValueInGapRange","from","to","_getComposedPath","evt","composedPath","_isExcludeElement","element","tagName","dataset","scrollable","_isInitEvent","initialEvtClientX","initialEvtClientY","_composedPath","i","length","_el","left","top","right","bottom","getClientRects","useXYMovable","refElement","useEffect","_element","getRefValue","_elementStyle","_diffX","_diffY","_initialEvtClientX","_initialEvtClientY","_moveDone","_prevTop","_prevLeft","_nextLeft","window","innerWidth","clientWidth","_nextTop","innerHeight","clientHeight","webkitTransform","transform","_hMove","cancelable","stopPropagation","preventDefault","cursor","getClientX","getClientY","_translate","_hResetEvent","clearEventListener","removeEventListener","addEventListener","_default","exports","default"],"sources":["../../../src/components/hooks/useXYMovable.js"],"sourcesContent":["import {\r\n  useEffect,\r\n  getRefValue,\r\n  getClientX,\r\n  getClientY\r\n} from '../uiApi';\r\n\r\nimport { HAS_TOUCH_EVENTS } from '../has';\r\n\r\nconst _assign = Object.assign\r\n, _isArr = Array.isArray\r\n, _isFn = fn => typeof fn === 'function'\r\n, [\r\n  INIT_EVENT,\r\n  MOVE_EVENT,\r\n  CANCEL_EVENT,\r\n  RESET_EVENT\r\n] = HAS_TOUCH_EVENTS\r\n? ['touchstart','touchmove','touchcancel','touchend']\r\n: ['mousedown','mousemove','mouseleave','mouseup'];\r\n\r\nconst EVENT_OPTIONS = { passive: true }\r\n, MOVE_EVENT_OPTIONS = { passive: false };\r\n\r\nconst _fGetIntStyleProperty = (\r\n  propName\r\n) => (style) => parseInt(style[propName], 10)\r\n, _getIntStyleTop = _fGetIntStyleProperty('top')\r\n, _getIntStyleLeft = _fGetIntStyleProperty('left');\r\n\r\nconst VALUE_GAP = 8;\r\nconst _crNextValue = (\r\n  value,\r\n  maxValue\r\n) => value > 0\r\n  ? value > maxValue\r\n    ? maxValue - 2*VALUE_GAP\r\n    : value\r\n  : VALUE_GAP;\r\n\r\nconst START_EVENT_GAP = 22\r\nconst _isValueInGapRange = (\r\n  from,\r\n  to,\r\n  value\r\n) => value - from > START_EVENT_GAP\r\n  && to - value > START_EVENT_GAP;\r\nconst _getComposedPath = (\r\n  evt\r\n) => _isFn(evt.composedPath)\r\n  ? evt.composedPath()\r\n  : void 0;\r\n\r\nconst _isExcludeElement  = (\r\n  element\r\n) => element.tagName === 'BUTTON'\r\n || (element.dataset || {}).scrollable\r\n\r\nconst _isInitEvent = (\r\n  evt,\r\n  initialEvtClientX,\r\n  initialEvtClientY,\r\n  element\r\n) => {\r\n  const _composedPath = _getComposedPath(evt);\r\n  if (_isArr(_composedPath)) {\r\n    for(let i=0; i<_composedPath.length; i++){\r\n      const _el = _composedPath[i];\r\n      if (_isExcludeElement(_el)) {\r\n        return false;\r\n      }\r\n      if (_el === element) {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!HAS_TOUCH_EVENTS) { return true; }\r\n\r\n  const {\r\n    left,\r\n    top,\r\n    right,\r\n    bottom\r\n  } = element.getClientRects()[0];\r\n  return _isValueInGapRange(left, right, initialEvtClientX)\r\n    && _isValueInGapRange(top, bottom, initialEvtClientY);\r\n}\r\n\r\nconst useXYMovable = (\r\n  refElement\r\n) => {\r\n  /*eslint-disable react-hooks/exhaustive-deps */\r\n  useEffect(() => {\r\n    let _element = getRefValue(refElement)\r\n    , _elementStyle = _element.style\r\n    , _diffX = 0\r\n    , _diffY = 0\r\n    , _initialEvtClientX\r\n    , _initialEvtClientY;\r\n\r\n    function _moveDone () {\r\n      const _prevTop = _getIntStyleTop(_elementStyle)\r\n      , _prevLeft = _getIntStyleLeft(_elementStyle)\r\n      , _nextLeft = _crNextValue(\r\n          _prevLeft + _diffX,\r\n          window.innerWidth - _element.clientWidth\r\n        )\r\n      , _nextTop = _crNextValue(\r\n          _prevTop + _diffY,\r\n          window.innerHeight - _element.clientHeight\r\n        );\r\n\r\n      _assign(_elementStyle, {\r\n        top: `${_nextTop}px`,\r\n        left: `${_nextLeft}px`,\r\n        webkitTransform: '',\r\n        transform: ''\r\n      })\r\n\r\n      _diffX = 0\r\n      _diffY = 0\r\n    }\r\n\r\n    function _hMove(evt) {\r\n      if (evt.cancelable) {\r\n        evt.stopPropagation()\r\n        evt.preventDefault()\r\n      }\r\n\r\n      if (_diffX === 0 && _diffY === 0) {\r\n        _elementStyle.cursor = 'move'\r\n      }\r\n\r\n      _diffX = getClientX(evt) - _initialEvtClientX\r\n      _diffY = getClientY(evt) - _initialEvtClientY\r\n      const _translate = `translate(${_diffX}px,${_diffY}px)`\r\n      _assign(_elementStyle, {\r\n        webkitTransform: _translate,\r\n        transform: _translate\r\n      })\r\n    }\r\n\r\n    function _hResetEvent() {\r\n      clearEventListener()\r\n      _moveDone()\r\n    }\r\n\r\n    function clearEventListener() {\r\n      _elementStyle.cursor = ''\r\n      _element.removeEventListener(MOVE_EVENT, _hMove, MOVE_EVENT_OPTIONS)\r\n      _element.removeEventListener(CANCEL_EVENT, _hResetEvent, EVENT_OPTIONS)\r\n      _element.removeEventListener(RESET_EVENT, _hResetEvent, EVENT_OPTIONS)\r\n    }\r\n\r\n    _element.addEventListener(INIT_EVENT, (evt) => {\r\n      _initialEvtClientX = getClientX(evt)\r\n      _initialEvtClientY = getClientY(evt)\r\n      if (_element && _isInitEvent(evt, _initialEvtClientX, _initialEvtClientY, _element)) {\r\n        _element.addEventListener(MOVE_EVENT, _hMove, MOVE_EVENT_OPTIONS)\r\n        _element.addEventListener(CANCEL_EVENT, _hResetEvent, EVENT_OPTIONS)\r\n        _element.addEventListener(RESET_EVENT, _hResetEvent, EVENT_OPTIONS)\r\n      }\r\n    }, EVENT_OPTIONS)\r\n\r\n    return () => {\r\n      clearEventListener()\r\n      _elementStyle = null;\r\n      _element = null;\r\n    };\r\n  }, [])\r\n  //refElement\r\n  /*eslint-enable react-hooks/exhaustive-deps */\r\n}\r\n\r\nexport default useXYMovable\r\n"],"mappings":"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","ignoreList":[]}