{"version":3,"file":"ChartComponent.js","names":["_uiApi","require","_chart","_configChart","_interopRequireDefault","_merge","_deepEqual","_omit","_jsxRuntime","IGNORED_PROPERTIES","Chart","register","LineElement","LineController","BarElement","BarController","CategoryScale","LinearScale","PointElement","Legend","Tooltip","configChart","DF_OPTIONS","tooltips","callbacks","labelTextColor","tooltipItem","chartInst","data","datasets","datasetIndex","borderColor","_isNotShouldRerender","prevProps","nextProps","deepEqual","omit","strict","_renderChart","refChartInst","refCanvas","type","options","setRefValue","getRefValue","merge","_updateChart","config","update","ChartComponent","memo","_ref","height","width","redraw","onElementsClick","_refCanvas","useRef","_refChartInst","_hClick","useMemo","isFn","event","elems","getElementsAtEvent","length","useLayoutEffect","_chartInst","destroy","jsx","ref","onClick","_default","exports","default"],"sources":["../../../src/components/charts/ChartComponent.jsx"],"sourcesContent":["import {\r\n\tmemo,\r\n\tuseRef,\r\n\tuseMemo,\r\n\tuseLayoutEffect,\r\n\tisFn,\r\n\tgetRefValue,\r\n\tsetRefValue\r\n} from '../uiApi';\r\n\r\nimport {\r\n\tChart,\r\n\tLineElement,\r\n\tLineController,\r\n\tBarElement,\r\n\tBarController,\r\n\tLegend,\r\n  Tooltip,\r\n\tCategoryScale,\r\n\tLinearScale,\r\n\tPointElement\r\n} from 'chart.js';\r\n\r\nimport configChart from './configChart';\r\nimport merge from '../../utils/merge';\r\nimport deepEqual from '../../utils/deepEqual';\r\nimport omit from '../../utils/omit';\r\n\r\nconst IGNORED_PROPERTIES = [\r\n\t'id',\r\n\t'width',\r\n\t'height',\r\n\t'onElementsClick'\r\n];\r\n\r\nChart.register(\r\n\tLineElement,\r\n  LineController,\r\n\tBarElement,\r\n\tBarController,\r\n  CategoryScale,\r\n  LinearScale,\r\n  PointElement,\r\n  Legend,\r\n  Tooltip\r\n)\r\n\r\nconfigChart(Chart)\r\n\r\nconst DF_OPTIONS = {\r\n\ttooltips: {\r\n\t\tcallbacks: {\r\n\t\t\tlabelTextColor: function(tooltipItem, chartInst) {\r\n\t\t\t\t return chartInst.data.datasets[tooltipItem.datasetIndex].borderColor;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst _isNotShouldRerender = (\r\n\tprevProps,\r\n\tnextProps\r\n) => deepEqual(\r\n\tomit(prevProps, IGNORED_PROPERTIES),\r\n\tomit(nextProps, IGNORED_PROPERTIES),\r\n\t{ strict: true }\r\n)\r\n,  _renderChart = (\r\n\trefChartInst,\r\n\trefCanvas,\r\n\ttype,\r\n\tdata,\r\n\toptions\r\n) => {\r\n\t setRefValue(refChartInst, new Chart(getRefValue(refCanvas), {\r\n\t\t type,\r\n\t\t data,\r\n\t\t options: merge({...DF_OPTIONS}, options)\r\n\t}));\r\n}\r\n, _updateChart = (\r\n\tchartInst,\r\n\tdata,\r\n\toptions\r\n) => {\r\n\t if (options) {\r\n\t\t chartInst.options = merge(chartInst.options, options);\r\n\t }\r\n\t chartInst.config.data = {\r\n\t\t ...chartInst.config.data,\r\n\t\t ...data\r\n\t };\r\n\t chartInst.update();\r\n};\r\n\r\nconst ChartComponent = memo(({\r\n\t type='line',\r\n\t height=150,\r\n\t width=300,\r\n\t redraw=false,\r\n\t data,\r\n\t options,\r\n\t onElementsClick\r\n}) => {\r\n  const _refCanvas = useRef()\r\n\t, _refChartInst = useRef()\r\n\t, _hClick = useMemo(() => isFn(onElementsClick)\r\n\t    ? event => {\r\n\t\t\t\t  const elems = getRefValue(_refChartInst).getElementsAtEvent(event);\r\n\t\t\t\t  if (elems.length) {\r\n\t\t\t\t\t  onElementsClick(elems);\r\n\t\t\t\t  }\r\n\t\t\t  }\r\n\t\t\t: null\r\n  , [onElementsClick]);\r\n\r\n\tuseLayoutEffect(() => {\r\n\t\tconst _chartInst = getRefValue(_refChartInst);\r\n\t\tif (_chartInst) {\r\n\t\t\tif (redraw) {\r\n\t\t\t\t_chartInst.destroy()\r\n\t\t\t\t_renderChart(_refChartInst, _refCanvas, type, data, options)\r\n\t\t\t} else {\r\n\t\t\t\t_updateChart(_chartInst, data, options)\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n  /*eslint-disable react-hooks/exhaustive-deps */\r\n  useLayoutEffect(() => {\r\n\t\t_renderChart(_refChartInst, _refCanvas, type, data, options)\r\n\t  return () => {\r\n\t\t\tgetRefValue(_refChartInst).destroy()\r\n\t\t\tsetRefValue(_refChartInst, null)\r\n\t\t}\r\n\t}, [])\r\n\t// type, data, options\r\n\t/*eslint-enable react-hooks/exhaustive-deps */\r\n\r\n\treturn (\r\n\t\t<canvas\r\n\t\t\t ref={_refCanvas}\r\n\t\t\t height={height}\r\n\t\t\t width={width}\r\n\t\t\t onClick={_hClick}\r\n\t\t/>\r\n\t);\r\n}, _isNotShouldRerender);\r\n\r\n/*\r\nChartComp.propTypes = {\r\n  type: PropTypes.oneOf([\r\n\t  'line',\r\n\t\t'bar'\r\n\t]),\r\n\twidth: PropTypes.number,\r\n\theight: PropTypes.number,\r\n\tredraw: PropTypes.bool,\r\n\tdata: PropTypes.object.isRequired,\r\n\toptions: PropTypes.object,\r\n\tlegend: PropTypes.object,\r\n\tlegendOptions: PropTypes.object\r\n\tonElementsClick: PropTypes.func\r\n},\r\n*/\r\n\r\nexport default ChartComponent;\r\n"],"mappings":"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","ignoreList":[]}