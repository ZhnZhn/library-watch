{"version":3,"file":"AddToWatchDialog.js","names":["_uiApi","require","_memoFn","_useValidationMessages","_interopRequireDefault","_usePrevValue","_useProperty","_useRefItemCaption","_WatchActions","_watchListStore","_Msg","_ModalDialog","_RowText","_FlatButton","_RowInputSelect","_ValidationMessages","_jsxRuntime","S_BOLD","fontWeight","S_LH","lineHeight","S_DESCR","color","AddToWatchDialog","memoIsShow","props","_prevProps","usePrevValue","isShow","data","onClose","setGroupCaption","getGroupCaption","useProperty","_refListCaption","_handlerSelectList","useRefItemCaption","state","setState","useState","groupOptions","getWatchGroups","listOptions","validationMessages","setValidationMessages","_clearValidationMessages","useValidationMessages","_hSelectGroup","useCallback","group","caption","lists","_caption","prevState","_hClose","_hAdd","groupCaption","listCaption","getRefValue","_validationMessages","push","MSG_NOT_SELECTED","length","config","addWatchItem","_commandButtons","useMemo","jsx","default","title","timeout","onClick","useMsEdit","msEdit","forActionType","WAT_ADD_ITEM","message","messages","useEffect","_groupCaption","_groupOptions","setRefValue","_listOptions","getWatchListsByGroup","descr","jsxs","commandButtons","children","options","onSelect","style","textStyle","text","_default","exports"],"sources":["../../../src/components/browser-watch/AddToWatchDialog.jsx"],"sourcesContent":["import {\r\n  useState,\r\n  useMemo,\r\n  useCallback,\r\n  useEffect,\r\n  getRefValue,\r\n  setRefValue\r\n} from '../uiApi';\r\n\r\nimport { memoIsShow } from '../hoc/memoFn';\r\n\r\nimport useValidationMessages from '../hooks/useValidationMessages';\r\nimport usePrevValue from '../hooks/usePrevValue';\r\nimport useProperty from '../hooks/useProperty';\r\n\r\nimport useRefItemCaption from './useRefItemCaption';\r\n\r\nimport {\r\n  WAT_ADD_ITEM\r\n} from '../../flux/actions/WatchActions';\r\nimport {\r\n  addWatchItem,\r\n  useMsEdit,\r\n  getWatchGroups,\r\n  getWatchListsByGroup\r\n} from '../../flux/watch-list/watchListStore';\r\n\r\nimport {\r\n  MSG_NOT_SELECTED\r\n} from '../../constants/Msg';\r\n\r\nimport ModalDialog from '../zhn-moleculs/ModalDialog';\r\nimport RowText from './RowText';\r\nimport FlatButton from '../zhn-m/FlatButton';\r\nimport RowInputSelect from '../dialogs/rows/RowInputSelect';\r\nimport ValidationMessages from '../dialogs/rows/ValidationMessages';\r\n\r\nconst S_BOLD = { fontWeight: 'bold' }\r\n, S_LH = { lineHeight: 2 }\r\n, S_DESCR = {\r\n  fontWeight: 'bold',\r\n  color: 'gray'\r\n};\r\n\r\nconst AddToWatchDialog = memoIsShow((props) => {\r\n  const _prevProps = usePrevValue(props)\r\n  , {\r\n    isShow,\r\n    data,\r\n    onClose\r\n  } = props\r\n  , [\r\n    setGroupCaption,\r\n    getGroupCaption\r\n  ] = useProperty(null)\r\n  , [\r\n    _refListCaption,\r\n    _handlerSelectList\r\n  ] = useRefItemCaption()\r\n  , [\r\n    state,\r\n    setState\r\n  ] = useState(() => ({\r\n    groupOptions: getWatchGroups(),\r\n    listOptions: []\r\n  }))\r\n  , {\r\n    groupOptions,\r\n    listOptions\r\n  } = state\r\n  , [\r\n    validationMessages,\r\n    setValidationMessages,\r\n    _clearValidationMessages\r\n  ] = useValidationMessages()\r\n  , _hSelectGroup = useCallback(group => {\r\n    const {\r\n      caption,\r\n      lists\r\n    } = group || {}\r\n    , _caption = caption\r\n       ? (setState(prevState => ({\r\n           ...prevState,\r\n           listOptions: lists || []\r\n         })), caption)\r\n       : null;\r\n    setGroupCaption(_caption)\r\n  }, [setGroupCaption])\r\n  /*eslint-disable react-hooks/exhaustive-deps */\r\n  , _hClose = useCallback(() => {\r\n     _clearValidationMessages()\r\n     onClose()\r\n  }, [])\r\n  // _clearValidationMessages, onClose\r\n  , _hAdd = useCallback(() => {\r\n     const groupCaption = getGroupCaption()\r\n     , listCaption = getRefValue(_refListCaption)\r\n     , _validationMessages = [];\r\n     if (!groupCaption){\r\n       _validationMessages.push(MSG_NOT_SELECTED('Group'));\r\n     }\r\n     if (!listCaption) {\r\n       _validationMessages.push(MSG_NOT_SELECTED('List'));\r\n     }\r\n     if (_validationMessages.length === 0){\r\n       const { caption, config } = data;\r\n       addWatchItem({\r\n         caption,\r\n         groupCaption,\r\n         listCaption,\r\n         config\r\n       });\r\n     } else {\r\n       setValidationMessages(_validationMessages)\r\n     }\r\n  }, [data])\r\n  // _refListCaption, setValidationMessages\r\n  /*eslint-enable react-hooks/exhaustive-deps */\r\n  , _commandButtons = useMemo(() => [\r\n    <FlatButton\r\n      key=\"add\"\r\n      caption=\"Add\"\r\n      title=\"Click to add to watch list\"\r\n      timeout={0}\r\n      onClick={_hAdd}\r\n    />\r\n  ], [_hAdd]);\r\n\r\n  useMsEdit(msEdit => {\r\n    if (msEdit && msEdit.forActionType === WAT_ADD_ITEM) {\r\n      if (msEdit.message) {\r\n        setValidationMessages(msEdit.messages)\r\n      } else {\r\n        _hClose()\r\n      }\r\n    }\r\n  })\r\n\r\n  //UNSAFE_componentWillReceiveProps(nextProps)\r\n  /*eslint-disable react-hooks/exhaustive-deps */\r\n  useEffect(() => {\r\n    if (_prevProps && _prevProps !== props && _prevProps.isShow !== isShow) {\r\n      const _groupCaption = getGroupCaption()\r\n      , _groupOptions = getWatchGroups();\r\n      if (_groupOptions !== groupOptions){\r\n        setGroupCaption(null)\r\n        setRefValue(_refListCaption, null)\r\n        setState({\r\n          groupOptions: _groupOptions,\r\n          listOptions: []\r\n        })\r\n      } else if (_groupCaption){\r\n        const _listOptions = getWatchListsByGroup(_groupCaption);\r\n        if (_listOptions !== listOptions){\r\n          setRefValue(_refListCaption, null)\r\n          setState(prevState => ({\r\n            ...prevState,\r\n            listOptions: _listOptions\r\n          }))\r\n        }\r\n      }\r\n    }\r\n  })\r\n  /*eslint-enable react-hooks/exhaustive-deps */\r\n\r\n  const {\r\n    caption,\r\n    config\r\n  } = data\r\n  , { descr } = config || {};\r\n\r\n  return (\r\n    <ModalDialog\r\n       caption=\"Add To Watch List\"\r\n       isShow={isShow}\r\n       commandButtons={_commandButtons}\r\n       onClose={_hClose}\r\n    >\r\n      <RowInputSelect\r\n        caption=\"Group\"\r\n        options={groupOptions}\r\n        onSelect={_hSelectGroup}\r\n      />\r\n      <RowInputSelect\r\n        caption=\"List\"\r\n        options={listOptions}\r\n        onSelect={_handlerSelectList}\r\n      />\r\n      <RowText\r\n        style={S_LH}\r\n        caption=\"Item\"\r\n        textStyle={S_BOLD}\r\n        text={caption}\r\n      />\r\n      <RowText\r\n        style={S_LH}\r\n        caption=\"Descr\"\r\n        textStyle={S_DESCR}\r\n        text={descr}\r\n      />\r\n      <ValidationMessages\r\n         validationMessages={validationMessages}\r\n       />\r\n    </ModalDialog>\r\n  );\r\n});\r\n\r\nexport default AddToWatchDialog\r\n"],"mappings":"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","ignoreList":[]}