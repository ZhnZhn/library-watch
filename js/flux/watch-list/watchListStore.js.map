{"version":3,"file":"watchListStore.js","names":["_merge","_interopRequireDefault","require","_dateFn","_saveJsonToFile","_localStorageFn","_storeApi","_compStore","_Msg","_WatchDefault","_WatchActions","_Fn","_DragDropFn","_GroupFn","_ListFn","_ItemFn","STORAGE_KEY","DIALOG_CAPTION","WATCH_FILE_NAME","_crStore","isWatchEdited","watchList","WatchDefault","msEdit","_watchListStore","createStoreWithSelector","_selectWatchList","state","_selectMsEdit","_selectIsWatchEdited","_set","setState","_get","getState","getIsWatchEdited","exports","getWatchList","useWatchList","fCrUse","useMsEdit","useIsWatchEdited","getWatchGroups","groups","getWatchListsByGroup","groupCaption","group","findGroup","lists","_onEditWatch","result","forActionType","isDone","messages","message","_fEditWatch","editEntity","EDIT_ENTITY","option","crGroup","addGroup","WAT_CREATE_GROUP","renGroup","renameGroup","WAT_RENAME_GROUP","delGroup","deleteGroup","WAT_DELETE_GROUP","crList","addList","WAT_CREATE_LIST","renList","renameList","WAT_RENAME_LIST","delList","deleteList","WAT_DELETE_LIST","_addItem","addItem","WAT_ADD_ITEM","_onDragDrop","showAlert","_fDdEntity","ddEntity","ddItem","dragDropItem","ddList","dragDropList","ddGroup","dragDropGroup","_crMsgOption","descr","caption","_saveWl","isShowDialog","_err","writeToLs","showInfo","MSG_WATCH_SAVED","MSG_WATCH_PREV","initWatchList","readFromLs","saveWatchList","_temp","addWatchItem","item","deleteWatchItem","deleteItem","backupToJson","yyyymmdd","mlsToYmd","Date","now","_fileName","saveJsonToFile","loadFromJson","progressEvent","merge","JSON","parse","target","exc","ALERT_LOAD_FROM_JSON"],"sources":["../../../src/flux/watch-list/watchListStore.js"],"sourcesContent":["import merge from '../../utils/merge';\r\nimport { mlsToYmd } from '../../utils/dateFn';\r\nimport saveJsonToFile from './saveJsonToFile';\r\nimport {\r\n  readFromLs,\r\n  writeToLs\r\n} from '../../utils/localStorageFn';\r\n\r\nimport {\r\n  createStoreWithSelector,\r\n  fCrUse\r\n} from '../storeApi';\r\n\r\nimport {\r\n  showAlert,\r\n  showInfo\r\n} from '../compStore';\r\n\r\nimport {\r\n  MSG_WATCH_SAVED,\r\n  MSG_WATCH_PREV,\r\n  ALERT_LOAD_FROM_JSON\r\n} from '../../constants/Msg';\r\nimport WatchDefault from '../../constants/WatchDefault';\r\n\r\nimport {\r\n  WAT_CREATE_GROUP,\r\n  WAT_RENAME_GROUP,\r\n  WAT_DELETE_GROUP,\r\n\r\n  WAT_CREATE_LIST,\r\n  WAT_RENAME_LIST,\r\n  WAT_DELETE_LIST,\r\n\r\n  WAT_ADD_ITEM\r\n} from '../actions/WatchActions';\r\n\r\nimport { findGroup } from './Fn';\r\nimport {\r\n  dragDropGroup,\r\n  dragDropList,\r\n  dragDropItem\r\n} from './DragDropFn';\r\nimport {\r\n  addGroup,\r\n  renameGroup,\r\n  deleteGroup\r\n} from './GroupFn';\r\nimport {\r\n  addList,\r\n  renameList,\r\n  deleteList\r\n} from './ListFn';\r\nimport {\r\n  addItem,\r\n  deleteItem\r\n} from './ItemFn';\r\n\r\nconst STORAGE_KEY = 'WL_LIBRARY_WATCH'\r\n, DIALOG_CAPTION ='Watch List:'\r\n, WATCH_FILE_NAME = \"WatchItems\";\r\n\r\nconst _crStore = () => ({\r\n  isWatchEdited: false,\r\n  watchList: WatchDefault,\r\n  msEdit: {}\r\n})\r\n, _watchListStore = createStoreWithSelector(_crStore)\r\n, _selectWatchList = state => state.watchList\r\n, _selectMsEdit = state => state.msEdit\r\n, _selectIsWatchEdited = state => state.isWatchEdited\r\n, _set = _watchListStore.setState\r\n, _get = _watchListStore.getState;\r\n\r\nexport const getIsWatchEdited = () => _selectIsWatchEdited(_get());\r\n\r\nexport const getWatchList = () => _selectWatchList(_get())\r\n\r\nexport const useWatchList = fCrUse(_watchListStore, _selectWatchList)\r\nexport const useMsEdit = fCrUse(_watchListStore, _selectMsEdit)\r\nexport const useIsWatchEdited = fCrUse(_watchListStore, _selectIsWatchEdited)\r\n\r\nexport const getWatchGroups = () => (getWatchList() || {}).groups\r\nexport const getWatchListsByGroup = (groupCaption) => {\r\n  const group = findGroup(getWatchList(), groupCaption);\r\n  return group\r\n    ? group.lists\r\n    : [];\r\n}\r\n\r\nconst _onEditWatch = (\r\n  result,\r\n  forActionType\r\n) => {\r\n  if (result.isDone){\r\n    _set({\r\n      isWatchEdited: true,\r\n      watchList: { ...getWatchList() },\r\n      msEdit: { forActionType }\r\n    })\r\n  } else {\r\n    _set({\r\n      msEdit: {\r\n        messages:[result.message],\r\n        forActionType\r\n      }\r\n    })\r\n  }\r\n}\r\nconst _fEditWatch = (\r\n  editEntity,\r\n  EDIT_ENTITY\r\n) => (option) => {\r\n  _onEditWatch(\r\n    editEntity(getWatchList(), option),\r\n    EDIT_ENTITY\r\n  )\r\n};\r\nexport const crGroup = _fEditWatch(addGroup, WAT_CREATE_GROUP)\r\nexport const renGroup = _fEditWatch(renameGroup, WAT_RENAME_GROUP)\r\nexport const delGroup = _fEditWatch(deleteGroup, WAT_DELETE_GROUP)\r\nexport const crList = _fEditWatch(addList, WAT_CREATE_LIST)\r\nexport const renList = _fEditWatch(renameList, WAT_RENAME_LIST)\r\nexport const delList = _fEditWatch(deleteList, WAT_DELETE_LIST)\r\nconst _addItem = _fEditWatch(addItem, WAT_ADD_ITEM);\r\n\r\nconst _onDragDrop = (\r\n  result\r\n) => {\r\n  if (result.isDone){\r\n    _set({\r\n      isWatchEdited: true,\r\n      watchList: {...getWatchList()}\r\n    })\r\n  } else {\r\n    showAlert(result)\r\n  }\r\n}\r\nconst _fDdEntity = (ddEntity) => (option) => {\r\n  _onDragDrop(ddEntity(getWatchList(), option))\r\n};\r\nexport const ddItem = _fDdEntity(dragDropItem)\r\nexport const ddList = _fDdEntity(dragDropList)\r\nexport const ddGroup = _fDdEntity(dragDropGroup)\r\n\r\nconst _crMsgOption = (\r\n  descr\r\n) => ({\r\n  caption: DIALOG_CAPTION,\r\n  descr\r\n});\r\n\r\nconst _saveWl = (\r\n  isShowDialog=true\r\n) => {\r\n  if (getIsWatchEdited()){\r\n    const _err = writeToLs(STORAGE_KEY, getWatchList());\r\n    if (_err) {\r\n      showAlert(_crMsgOption(_err.message))\r\n    } else {\r\n     _set({ isWatchEdited: false })\r\n     if (isShowDialog) {\r\n       showInfo(_crMsgOption(MSG_WATCH_SAVED))\r\n     }\r\n    }\r\n  } else {\r\n     showInfo(_crMsgOption(MSG_WATCH_PREV))\r\n  }\r\n}\r\n\r\nexport const initWatchList = () => {\r\n  _set({\r\n    watchList: readFromLs(STORAGE_KEY)[0] || WatchDefault\r\n  })\r\n}\r\nexport const saveWatchList = ({ isShowDialog } = {}) => {\r\n  _saveWl(isShowDialog)\r\n}\r\nexport const addWatchItem = (item) => {\r\n  _addItem(item)\r\n}\r\nexport const deleteWatchItem = (option) => {\r\n  deleteItem(getWatchList(), option);\r\n  _set({\r\n    isWatchEdited: true,\r\n    watchList: {...getWatchList()}\r\n  })\r\n}\r\n\r\nexport const backupToJson = () => {\r\n  const yyyymmdd = mlsToYmd(Date.now())\r\n  , _fileName = `${WATCH_FILE_NAME}_${yyyymmdd}.json`;\r\n\r\n  saveJsonToFile(getWatchList(), _fileName)\r\n}\r\nexport const loadFromJson = (option) => {\r\n  try {\r\n    const { progressEvent } = option\r\n    merge(\r\n      getWatchList(),\r\n      JSON.parse(progressEvent.target.result)\r\n    );\r\n    _set({\r\n      isWatchEdited: true,\r\n      watchList: {...getWatchList()}\r\n    })\r\n  } catch(exc) {\r\n    showAlert({...ALERT_LOAD_FROM_JSON })\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}