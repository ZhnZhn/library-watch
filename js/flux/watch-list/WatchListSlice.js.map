{"version":3,"sources":["../../../src/flux/watch-list/WatchListSlice.js"],"names":["STORAGE_KEY","CAPTION_WATCH_SAVE","CAPTION_WATCH_EXPORT","WATCH_FILE_NAME","WatchListSlice","watchList","WatchDefault","isWatchEdited","initWatchList","LocalForage","getItem","then","value","trigger","BrowserActionTypes","UPDATE_WATCH_BROWSER","getWatchEdited","setWatchEdited","WatchActionTypes","SET_WATCH_EDITED","getWatchList","getWatchGroups","groups","getWatchListsByGroup","groupCaption","group","Logic","findGroup","lists","onAddItem","item","_onEditWatch","addItem","ADD_ITEM","onRemoveItem","option","removeItem","_onDragDrop","result","isDone","showAlertDialog","onDragDropItem","dragDropItem","onDragDropList","dragDropList","onDragDropGroup","dragDropGroup","onSaveWatch","setItem","onShowModalDialog","ModalDialog","INFO","caption","descr","Msg","WATCH_SAVED","console","log","error","WATCH_PREV","forActionType","EDIT_WATCH_COMPLETED","EDIT_WATCH_FAILED","messages","message","onAddGroup","addGroup","ADD_GROUP","onRenameGroup","renameGroup","RENAME_GROUP","onDeleteGroup","deleteGroup","DELETE_GROUP","onCreateList","createList","CREATE_LIST","onRenameList","renameList","RENAME_LIST","onDeleteList","deleteList","DELETE_LIST","onBackupToJson","yyyymmdd","DateUtils","formatToYYYYMMDD","Date","now","_blob","Blob","JSON","stringify","type","_fileName","FileSaver","saveAs","ComponentActions","showModalDialog","WATCH_BACKUP_ZIP","onLoadFromJson","progressEvent","parse","target","exc","ALERT","Alert","LOAD_FROM_JSON"],"mappings":"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","sourcesContent":["\r\nimport LocalForage from 'localforage';\r\n//import JSZip from 'jszip';\r\nimport FileSaver from 'browser-filesaver';\r\nimport merge from 'lodash.merge';\r\n\r\nimport DateUtils from '../../utils/DateUtils';\r\n\r\nimport ComponentActions from '../actions/ComponentActions';\r\nimport { BrowserActionTypes } from '../actions/BrowserActions';\r\nimport { WatchActionTypes } from '../actions/WatchActions';\r\nimport WatchDefault from '../../constants/WatchDefault';\r\nimport { ModalDialog }  from '../../constants/Type';\r\nimport Msg from '../../constants/Msg';\r\n\r\nimport Logic from './Logic';\r\n\r\nconst STORAGE_KEY = 'WATCH_LIST_PACKAGE'\r\n    , CAPTION_WATCH_SAVE ='Watch List:'\r\n    , CAPTION_WATCH_EXPORT = \"BackUp Watch Items:\"\r\n    , WATCH_FILE_NAME = \"WatchItems\"\r\n\r\nconst WatchListSlice = {\r\n\r\n  watchList : WatchDefault,\r\n  isWatchEdited : false,\r\n\r\n  initWatchList(){\r\n    LocalForage.getItem(STORAGE_KEY).then((value) => {\r\n      this.watchList = (value)\r\n              ? value\r\n              : WatchDefault;\r\n      this.trigger(BrowserActionTypes.UPDATE_WATCH_BROWSER, this.watchList);\r\n    })\r\n    .catch(() => {\r\n      this.watchList = WatchDefault;\r\n      this.trigger(BrowserActionTypes.UPDATE_WATCH_BROWSER, this.watchList);\r\n    })\r\n  },\r\n  getWatchEdited(){\r\n    return this.isWatchEdited;\r\n  },\r\n  setWatchEdited(value){\r\n    this.isWatchEdited = value;\r\n    this.trigger(WatchActionTypes.SET_WATCH_EDITED, this.isWatchEdited);\r\n  },\r\n  getWatchList(){\r\n    return this.watchList;\r\n  },\r\n  getWatchGroups(){\r\n    return this.watchList.groups;\r\n  },\r\n  getWatchListsByGroup(groupCaption){\r\n    const group = Logic.findGroup(this.watchList, groupCaption);\r\n    if (!group) { return []; }\r\n    return group.lists;\r\n  },\r\n\r\n  onAddItem(item){\r\n    this._onEditWatch(\r\n      Logic.addItem(this.watchList, item), WatchActionTypes.ADD_ITEM\r\n    );\r\n  },\r\n  onRemoveItem(option){\r\n    Logic.removeItem(this.watchList, option);\r\n    this.setWatchEdited(true);\r\n    this.trigger(BrowserActionTypes.UPDATE_WATCH_BROWSER, this.watchList);\r\n  },\r\n\r\n  _onDragDrop(result){\r\n    if (result.isDone){\r\n       this.setWatchEdited(true);\r\n       this.trigger(BrowserActionTypes.UPDATE_WATCH_BROWSER, this.watchList);\r\n    } else {\r\n      this.showAlertDialog(result);\r\n    }\r\n  },\r\n\r\n  onDragDropItem(option){\r\n    this._onDragDrop(Logic.dragDropItem(this.watchList, option) );\r\n  },\r\n  onDragDropList(option){\r\n    this._onDragDrop(Logic.dragDropList(this.watchList, option) );\r\n  },\r\n  onDragDropGroup(option){\r\n    this._onDragDrop(Logic.dragDropGroup(this.watchList, option));\r\n  },\r\n\r\n  onSaveWatch(){\r\n    if (this.isWatchEdited){\r\n       LocalForage.setItem(STORAGE_KEY , this.watchList)\r\n          .then(()=>{\r\n             this.setWatchEdited(false);\r\n             this.onShowModalDialog(ModalDialog.INFO, {\r\n                caption : CAPTION_WATCH_SAVE,\r\n                descr : Msg.WATCH_SAVED\r\n             })\r\n             console.log(Msg.WATCH_SAVED);\r\n          })\r\n          .catch((error) => {\r\n             console.log(error);\r\n          })\r\n    } else {\r\n       this.onShowModalDialog(ModalDialog.INFO, {\r\n          caption : CAPTION_WATCH_SAVE,\r\n          descr : Msg.WATCH_PREV\r\n       })\r\n    }\r\n  },\r\n\r\n  _onEditWatch(result, forActionType){\r\n    if (result.isDone){\r\n      this.setWatchEdited(true);\r\n      this.trigger(BrowserActionTypes.UPDATE_WATCH_BROWSER, this.watchList);\r\n      this.trigger(WatchActionTypes.EDIT_WATCH_COMPLETED, {forActionType});\r\n    } else {\r\n      this.trigger(WatchActionTypes.EDIT_WATCH_FAILED, {\r\n          messages:[result.message],\r\n          forActionType\r\n      });\r\n    }\r\n  },\r\n  onAddGroup(option){\r\n    this._onEditWatch(\r\n      Logic.addGroup(this.watchList, option),\r\n      WatchActionTypes.ADD_GROUP\r\n    );\r\n  },\r\n  onRenameGroup(option){\r\n    this._onEditWatch(\r\n      Logic.renameGroup(this.watchList, option),\r\n      WatchActionTypes.RENAME_GROUP\r\n    );\r\n  },\r\n  onDeleteGroup(option){\r\n    this._onEditWatch(\r\n      Logic.deleteGroup(this.watchList, option),\r\n      WatchActionTypes.DELETE_GROUP\r\n    );\r\n  },\r\n\r\n  onCreateList(option){\r\n    this._onEditWatch(\r\n      Logic.createList(this.watchList, option),\r\n      WatchActionTypes.CREATE_LIST\r\n    );\r\n  },\r\n  onRenameList(option){\r\n    this._onEditWatch(\r\n      Logic.renameList(this.watchList, option),\r\n      WatchActionTypes.RENAME_LIST\r\n    );\r\n  },\r\n  onDeleteList(option){\r\n    this._onEditWatch(\r\n      Logic.deleteList(this.watchList, option),\r\n      WatchActionTypes.DELETE_LIST\r\n    );\r\n  },\r\n\r\n  onBackupToJson(){\r\n    const yyyymmdd = DateUtils.formatToYYYYMMDD(Date.now())\r\n        , _blob = new Blob([JSON.stringify(this.watchList)], {type: \"application/json\"})\r\n        , _fileName = `${WATCH_FILE_NAME}_${yyyymmdd}.json`\r\n\r\n    FileSaver.saveAs(_blob, _fileName);\r\n    ComponentActions.showModalDialog(ModalDialog.INFO, {\r\n      caption : CAPTION_WATCH_EXPORT,\r\n      descr : Msg.WATCH_BACKUP_ZIP(_fileName)\r\n    })\r\n  },\r\n\r\n  onLoadFromJson(option){\r\n    try {\r\n      const { progressEvent } = option\r\n      merge(this.watchList, JSON.parse(progressEvent.target.result));\r\n      this.setWatchEdited(true);\r\n      this.trigger(BrowserActionTypes.UPDATE_WATCH_BROWSER, this.watchList);\r\n    } catch(exc) {\r\n      ComponentActions.showModalDialog(ModalDialog.ALERT, {...Msg.Alert.LOAD_FROM_JSON })\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport default WatchListSlice\r\n"],"file":"WatchListSlice.js"}