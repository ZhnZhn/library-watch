{"version":3,"file":"itemStore.js","names":["_storeApi","require","_RouterLoad","_interopRequireDefault","_createItem","_createChartContainer","_storeAtoms","_browserFn","_dialogFn","_compStore","_ChartLogicFn","ALREADY_LOADED","caption","descr","CONSOLE_LOG_STYLE","_logLoadError","_ref","alertCaption","alertDescr","alertItemId","console","log","_crItems","_selectItems","fCrStoreSlice","_crMsItem","_selectMsItem","_crMsItemChartCont","fCrMsFromFn","chartCont","_crMsItemComp","chartType","browserType","Comp","createChartContainer","getDataConf","_crMsItemChartTypeClose","close","_crStore","itemStore","createStoreWithSelector","_set","_get","getStoreApi","getItemByType","exports","useMsItem","fCrUse","_createInitConfig","configs","isShow","showChart","_items","setMenuItemOpen","_loadItemCompleted","option","json","process","env","NODE_ENV","comp","createItem","unshift","setLoadingComplete","limitRemaining","addMenuItemCounter","_loadItemFailed","repo","showAlert","setLoadingFailed","isKeyTop","key","slice","toTopByKey","loadItem","loadId","crKey","RouterLoad","setLoading","setTimeout","closeChart","filter","minusMenuItemCounter","closeChartContainer","setMenuItemClose","closeCompItemList","removeItems","removeAll","items","resetMenuItemCounter","moveToTop"],"sources":["../../src/flux/itemStore.js"],"sourcesContent":["import {\r\n  createStoreWithSelector,\r\n  getStoreApi,\r\n  fCrStoreSlice,\r\n  fCrMsFromFn,\r\n  fCrUse\r\n} from './storeApi';\r\n\r\nimport RouterLoad from './logic/RouterLoad';\r\nimport createItem from './logic/createItem';\r\nimport createChartContainer from './logic/createChartContainer';\r\n\r\nimport {\r\n  setLoading,\r\n  setLoadingComplete,\r\n  setLoadingFailed\r\n} from './storeAtoms';\r\n\r\nimport {\r\n  setMenuItemOpen,\r\n  setMenuItemClose,\r\n  addMenuItemCounter,\r\n  minusMenuItemCounter,\r\n  resetMenuItemCounter\r\n} from './browserFn';\r\nimport { getDataConf } from './dialogFn'\r\nimport { showAlert } from './compStore';\r\n\r\nimport {\r\n  toTopByKey,\r\n  removeAll\r\n} from './stores/chart/ChartLogicFn';\r\n\r\nconst ALREADY_LOADED = {\r\n  caption: 'Already loaded',\r\n  descr: 'This item already has been loaded\\nto container, moved to top.'\r\n};\r\n\r\nconst CONSOLE_LOG_STYLE = 'color:rgb(237, 88, 19);';\r\nconst _logLoadError = ({\r\n  alertCaption,\r\n  alertDescr,\r\n  alertItemId\r\n}) => {\r\n  console.log('%c'+ alertCaption + ':' + alertItemId, CONSOLE_LOG_STYLE);\r\n  console.log('%c' + alertDescr, CONSOLE_LOG_STYLE);\r\n};\r\n\r\nconst [\r\n  _crItems,\r\n  _selectItems\r\n] = fCrStoreSlice(\"items\")\r\n, [\r\n  _crMsItem,\r\n  _selectMsItem\r\n] = fCrStoreSlice(\"msItem\")\r\n\r\n, _crMsItemChartCont = fCrMsFromFn(\r\n  _crMsItem,\r\n  chartCont => ({ chartCont })\r\n)\r\n, _crMsItemComp = fCrMsFromFn(\r\n  _crMsItem,\r\n  (chartType, browserType) => ({\r\n    Comp: createChartContainer(\r\n      getDataConf(chartType),\r\n      browserType\r\n    )\r\n  })\r\n)\r\n, _crMsItemChartTypeClose = fCrMsFromFn(\r\n  _crMsItem,\r\n  chartType => ({\r\n    chartType,\r\n    close: true\r\n  })\r\n);\r\n\r\nconst _crStore = () => ({\r\n  ..._crItems({}),\r\n  ..._crMsItem()\r\n})\r\n, itemStore = createStoreWithSelector(_crStore)\r\n, [_set, _get] = getStoreApi(itemStore);\r\n\r\nexport const getItemByType = (chartType) => _selectItems(_get())[chartType];\r\n\r\nexport const useMsItem = fCrUse(itemStore, _selectMsItem)\r\n\r\nconst _createInitConfig = (chartType) => ({\r\n  chartType: chartType,\r\n  configs: [],\r\n  isShow: true\r\n});\r\n\r\nexport const showChart = (\r\n  chartType,\r\n  browserType\r\n) => {\r\n const chartCont = getItemByType(chartType);\r\n if (chartCont){\r\n   chartCont.isShow = true;\r\n   _set(_crMsItemChartCont(chartCont))\r\n } else {\r\n   const _items = _selectItems(_get());\r\n   _items[chartType] = _createInitConfig(chartType);\r\n   _set(_crMsItemComp(chartType, browserType))\r\n }\r\n setMenuItemOpen(chartType, browserType);\r\n}\r\n\r\nconst _loadItemCompleted = (\r\n  option,\r\n  json\r\n) => {\r\n  /* eslint-disable no-undef */\r\n  if (process.env.NODE_ENV !== 'production'){\r\n  /* eslint-enable no-undef */\r\n    console.log(option);\r\n    console.log(json);\r\n  }\r\n\r\n  const {\r\n    chartType,\r\n    browserType\r\n  } = option\r\n  , comp = createItem(\r\n     option,\r\n     json,\r\n     { chartType, browserType}\r\n   )\r\n  , chartCont = getItemByType(chartType);\r\n\r\n  if (chartCont){\r\n    chartCont.configs.unshift(comp);\r\n    chartCont.isShow = true;\r\n    _set(_crMsItemChartCont(chartCont))\r\n  } else {\r\n    const _items = _selectItems(_get())\r\n    _items[chartType] = _createInitConfig(chartType);\r\n    _items[chartType].configs.unshift(comp);\r\n    _set(_crMsItemComp(chartType, browserType))\r\n  }\r\n\r\n  setLoadingComplete(option.limitRemaining)\r\n  addMenuItemCounter(chartType, browserType);\r\n}\r\n, _loadItemFailed = (option) => {\r\n  option.alertItemId = option.alertItemId\r\n    || option.repo || '';\r\n  showAlert(option)\r\n  _logLoadError(option);\r\n  setLoadingFailed(option.limitRemaining)\r\n}\r\n\r\nconst isKeyTop = (\r\n  key,\r\n  option\r\n) => {\r\n  const {\r\n    chartType\r\n  } = option\r\n  , slice = getItemByType(chartType);\r\n  return toTopByKey(slice, key);\r\n}\r\n\r\nexport const loadItem = (\r\n  chartType,\r\n  browserType,\r\n  option\r\n) => {\r\n  const { loadId='LW' } = option;\r\n  option.chartType = chartType;\r\n  option.browserType = browserType;\r\n\r\n  const {\r\n    crKey,\r\n    loadItem\r\n  } = RouterLoad[loadId]\r\n  , key = crKey(option);\r\n  if (!isKeyTop(key, option)) {\r\n    option.key = key\r\n    setLoading()\r\n    loadItem(option, _loadItemCompleted, _loadItemFailed);\r\n  } else {\r\n    setTimeout(() => showAlert(ALREADY_LOADED), 1000)    \r\n    showChart(chartType, browserType)\r\n  }\r\n}\r\n\r\nexport const closeChart = (\r\n  chartType,\r\n  browserType,\r\n  key\r\n) => {\r\n  const chartCont = getItemByType(chartType);\r\n  chartCont.configs = chartCont\r\n    .configs.filter(comp => comp.key !== key)\r\n  _set(_crMsItemChartCont(chartCont))\r\n  minusMenuItemCounter(chartType, browserType);\r\n}\r\n\r\nexport const closeChartContainer = setMenuItemClose\r\n\r\nexport const closeCompItemList = (\r\n  chartType,\r\n  browserType\r\n) => {\r\n  _set(_crMsItemChartTypeClose(chartType))\r\n}\r\n\r\nexport const removeItems = (\r\n  chartType,\r\n  browserType\r\n) => {\r\n  const chartCont = removeAll(\r\n    _get().items,\r\n    chartType\r\n  );\r\n  resetMenuItemCounter(chartType, browserType)\r\n  _set(_crMsItemChartCont(chartCont))\r\n}\r\n\r\nexport const moveToTop = (\r\n  chartType,\r\n  key\r\n) => {\r\n  const chartCont = getItemByType(chartType);\r\n  if (toTopByKey(chartCont, key)) {\r\n   _set(_crMsItemChartCont(chartCont))\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}